<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Mini DataCatalog - Frontend</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h1>Mini DataCatalog - Datasources</h1>
  <p>برای مشاهدهٔ داده‌ها، توکن (JWT) را در کادر زیر قرار بده و دکمهٔ Load رو بزن.</p>
  <input id="token" style="width:80%" placeholder="Paste JWT here"/>
  <button id="btn">Load datasources</button>
  <pre id="out"></pre>
  <table id="tbl" style="display:none">
    <thead><tr><th>id</th><th>name</th><th>path</th><th>created_at</th></tr></thead>
    <tbody id="body"></tbody>
  </table>

  <script>
    const btn = document.getElementById('btn');
    const out = document.getElementById('out');
    const tbl = document.getElementById('tbl');
    const body = document.getElementById('body');

    btn.onclick = async () => {
      const token = document.getElementById('token').value.trim();
      if (!token) { alert('توکن را وارد کنید'); return; }
      out.textContent = 'Loading...';
      try {
        const resp = await fetch('/meta/datasources', {
          headers: { Authorization: 'Bearer ' + token }
        });
        if (!resp.ok) {
          out.textContent = 'HTTP ' + resp.status + '\\n' + await resp.text();
          tbl.style.display = 'none';
          return;
        }
        const data = await resp.json();
        out.textContent = JSON.stringify(data, null, 2);
        body.innerHTML = '';
        (data.items||[]).forEach(it => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${it.id}</td><td>${it.name}</td><td>${it.path}</td><td>${it.created_at}</td>`;
          body.appendChild(tr);
        });
        tbl.style.display = data.items && data.items.length ? 'table' : 'none';
      } catch (e) {
        out.textContent = 'Fetch error: ' + e.toString();
      }
    };
  </script>
</body>
</html>
